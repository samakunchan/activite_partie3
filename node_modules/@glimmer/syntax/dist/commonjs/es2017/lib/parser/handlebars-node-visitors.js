"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.HandlebarsNodeVisitors = undefined;

var _builders = require("../builders");

var _builders2 = _interopRequireDefault(_builders);

var _utils = require("../utils");

var _parser = require("../parser");

var _syntaxError = require("../errors/syntax-error");

var _syntaxError2 = _interopRequireDefault(_syntaxError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class HandlebarsNodeVisitors extends _parser.Parser {
    constructor() {
        super(...arguments);
        this.cursorCount = 0;
    }
    cursor() {
        return `%cursor:${this.cursorCount++}%`;
    }
    Program(program) {
        let body = [];
        this.cursorCount = 0;
        let node = _builders2.default.program(body, program.blockParams, program.loc);
        let i,
            l = program.body.length;
        this.elementStack.push(node);
        if (l === 0) {
            return this.elementStack.pop();
        }
        for (i = 0; i < l; i++) {
            this.acceptNode(program.body[i]);
        }
        // Ensure that that the element stack is balanced properly.
        let poppedNode = this.elementStack.pop();
        if (poppedNode !== node) {
            let elementNode = poppedNode;
            throw new _syntaxError2.default("Unclosed element `" + elementNode.tag + "` (on line " + elementNode.loc.start.line + ").", elementNode.loc);
        }
        return node;
    }
    BlockStatement(block) {
        if (this.tokenizer['state'] === 'comment') {
            this.appendToCommentData(this.sourceForNode(block));
            return;
        }
        if (this.tokenizer['state'] !== 'comment' && this.tokenizer['state'] !== 'data' && this.tokenizer['state'] !== 'beforeData') {
            throw new _syntaxError2.default("A block may only be used inside an HTML element or another block.", block.loc);
        }
        let { path, params, hash } = acceptCallNodes(this, block);
        let program = this.Program(block.program);
        let inverse = block.inverse ? this.Program(block.inverse) : null;
        if (path.original === 'in-element') {
            hash = addInElementHash(this.cursor(), hash, block.loc);
        }
        let node = _builders2.default.block(path, params, hash, program, inverse, block.loc);
        let parentProgram = this.currentElement();
        (0, _utils.appendChild)(parentProgram, node);
    }
    MustacheStatement(rawMustache) {
        let { tokenizer } = this;
        if (tokenizer['state'] === 'comment') {
            this.appendToCommentData(this.sourceForNode(rawMustache));
            return;
        }
        let mustache;
        let { escaped, loc } = rawMustache;
        if (rawMustache.path.type.match(/Literal$/)) {
            mustache = {
                type: 'MustacheStatement',
                path: this.acceptNode(rawMustache.path),
                params: [],
                hash: _builders2.default.hash(),
                escaped,
                loc
            };
        } else {
            let { path, params, hash } = acceptCallNodes(this, rawMustache);
            mustache = _builders2.default.mustache(path, params, hash, !escaped, loc);
        }
        switch (tokenizer['state']) {
            // Tag helpers
            case "tagName":
                addElementModifier(this.currentStartTag, mustache);
                tokenizer['state'] = "beforeAttributeName";
                break;
            case "beforeAttributeName":
                addElementModifier(this.currentStartTag, mustache);
                break;
            case "attributeName":
            case "afterAttributeName":
                this.beginAttributeValue(false);
                this.finishAttributeValue();
                addElementModifier(this.currentStartTag, mustache);
                tokenizer['state'] = "beforeAttributeName";
                break;
            case "afterAttributeValueQuoted":
                addElementModifier(this.currentStartTag, mustache);
                tokenizer['state'] = "beforeAttributeName";
                break;
            // Attribute values
            case "beforeAttributeValue":
                this.beginAttributeValue(false);
                appendDynamicAttributeValuePart(this.currentAttribute, mustache);
                tokenizer['state'] = 'attributeValueUnquoted';
                break;
            case "attributeValueDoubleQuoted":
            case "attributeValueSingleQuoted":
            case "attributeValueUnquoted":
                appendDynamicAttributeValuePart(this.currentAttribute, mustache);
                break;
            // TODO: Only append child when the tokenizer state makes
            // sense to do so, otherwise throw an error.
            default:
                (0, _utils.appendChild)(this.currentElement(), mustache);
        }
        return mustache;
    }
    ContentStatement(content) {
        updateTokenizerLocation(this.tokenizer, content);
        this.tokenizer.tokenizePart(content.value);
        this.tokenizer.flushData();
    }
    CommentStatement(rawComment) {
        let { tokenizer } = this;
        if (tokenizer['state'] === 'comment') {
            this.appendToCommentData(this.sourceForNode(rawComment));
            return null;
        }
        let { value, loc } = rawComment;
        let comment = _builders2.default.mustacheComment(value, loc);
        switch (tokenizer['state']) {
            case "beforeAttributeName":
                this.currentStartTag.comments.push(comment);
                break;
            case 'beforeData':
            case 'data':
                (0, _utils.appendChild)(this.currentElement(), comment);
                break;
            default:
                throw new _syntaxError2.default(`Using a Handlebars comment when in the \`${tokenizer['state']}\` state is not supported: "${comment.value}" on line ${loc.start.line}:${loc.start.column}`, rawComment.loc);
        }
        return comment;
    }
    PartialStatement(partial) {
        let { loc } = partial;
        throw new _syntaxError2.default(`Handlebars partials are not supported: "${this.sourceForNode(partial, partial.name)}" at L${loc.start.line}:C${loc.start.column}`, partial.loc);
    }
    PartialBlockStatement(partialBlock) {
        let { loc } = partialBlock;
        throw new _syntaxError2.default(`Handlebars partial blocks are not supported: "${this.sourceForNode(partialBlock, partialBlock.name)}" at L${loc.start.line}:C${loc.start.column}`, partialBlock.loc);
    }
    Decorator(decorator) {
        let { loc } = decorator;
        throw new _syntaxError2.default(`Handlebars decorators are not supported: "${this.sourceForNode(decorator, decorator.path)}" at L${loc.start.line}:C${loc.start.column}`, decorator.loc);
    }
    DecoratorBlock(decoratorBlock) {
        let { loc } = decoratorBlock;
        throw new _syntaxError2.default(`Handlebars decorator blocks are not supported: "${this.sourceForNode(decoratorBlock, decoratorBlock.path)}" at L${loc.start.line}:C${loc.start.column}`, decoratorBlock.loc);
    }
    SubExpression(sexpr) {
        let { path, params, hash } = acceptCallNodes(this, sexpr);
        return _builders2.default.sexpr(path, params, hash, sexpr.loc);
    }
    PathExpression(path) {
        let { original, loc } = path;
        let parts;
        if (original.indexOf('/') !== -1) {
            if (original.slice(0, 2) === './') {
                throw new _syntaxError2.default(`Using "./" is not supported in Glimmer and unnecessary: "${path.original}" on line ${loc.start.line}.`, path.loc);
            }
            if (original.slice(0, 3) === '../') {
                throw new _syntaxError2.default(`Changing context using "../" is not supported in Glimmer: "${path.original}" on line ${loc.start.line}.`, path.loc);
            }
            if (original.indexOf('.') !== -1) {
                throw new _syntaxError2.default(`Mixing '.' and '/' in paths is not supported in Glimmer; use only '.' to separate property paths: "${path.original}" on line ${loc.start.line}.`, path.loc);
            }
            parts = [path.parts.join('/')];
        } else {
            parts = path.parts;
        }
        let thisHead = false;
        // This is to fix a bug in the Handlebars AST where the path expressions in
        // `{{this.foo}}` (and similarly `{{foo-bar this.foo named=this.foo}}` etc)
        // are simply turned into `{{foo}}`. The fix is to push it back onto the
        // parts array and let the runtime see the difference. However, we cannot
        // simply use the string `this` as it means literally the property called
        // "this" in the current context (it can be expressed in the syntax as
        // `{{[this]}}`, where the square bracket are generally for this kind of
        // escaping â€“ such as `{{foo.["bar.baz"]}}` would mean lookup a property
        // named literally "bar.baz" on `this.foo`). By convention, we use `null`
        // for this purpose.
        if (original.match(/^this(\..+)?$/)) {
            thisHead = true;
        }
        return {
            type: 'PathExpression',
            original: path.original,
            this: thisHead,
            parts,
            data: path.data,
            loc: path.loc
        };
    }
    Hash(hash) {
        let pairs = [];
        for (let i = 0; i < hash.pairs.length; i++) {
            let pair = hash.pairs[i];
            pairs.push(_builders2.default.pair(pair.key, this.acceptNode(pair.value), pair.loc));
        }
        return _builders2.default.hash(pairs, hash.loc);
    }
    StringLiteral(string) {
        return _builders2.default.literal('StringLiteral', string.value, string.loc);
    }
    BooleanLiteral(boolean) {
        return _builders2.default.literal('BooleanLiteral', boolean.value, boolean.loc);
    }
    NumberLiteral(number) {
        return _builders2.default.literal('NumberLiteral', number.value, number.loc);
    }
    UndefinedLiteral(undef) {
        return _builders2.default.literal('UndefinedLiteral', undefined, undef.loc);
    }
    NullLiteral(nul) {
        return _builders2.default.literal('NullLiteral', null, nul.loc);
    }
}
exports.HandlebarsNodeVisitors = HandlebarsNodeVisitors;
function calculateRightStrippedOffsets(original, value) {
    if (value === '') {
        // if it is empty, just return the count of newlines
        // in original
        return {
            lines: original.split("\n").length - 1,
            columns: 0
        };
    }
    // otherwise, return the number of newlines prior to
    // `value`
    let difference = original.split(value)[0];
    let lines = difference.split(/\n/);
    let lineCount = lines.length - 1;
    return {
        lines: lineCount,
        columns: lines[lineCount].length
    };
}
function updateTokenizerLocation(tokenizer, content) {
    let line = content.loc.start.line;
    let column = content.loc.start.column;
    let offsets = calculateRightStrippedOffsets(content.original, content.value);
    line = line + offsets.lines;
    if (offsets.lines) {
        column = offsets.columns;
    } else {
        column = column + offsets.columns;
    }
    tokenizer.line = line;
    tokenizer.column = column;
}
function acceptCallNodes(compiler, node) {
    let path = compiler.PathExpression(node.path);
    let params = node.params ? node.params.map(e => compiler.acceptNode(e)) : [];
    let hash = node.hash ? compiler.Hash(node.hash) : _builders2.default.hash();
    return { path, params, hash };
}
function addElementModifier(element, mustache) {
    let { path, params, hash, loc } = mustache;
    if ((0, _utils.isLiteral)(path)) {
        let modifier = `{{${(0, _utils.printLiteral)(path)}}}`;
        let tag = `<${element.name} ... ${modifier} ...`;
        throw new _syntaxError2.default(`In ${tag}, ${modifier} is not a valid modifier: "${path.original}" on line ${loc && loc.start.line}.`, mustache.loc);
    }
    let modifier = _builders2.default.elementModifier(path, params, hash, loc);
    element.modifiers.push(modifier);
}
function addInElementHash(cursor, hash, loc) {
    let hasNextSibling = false;
    hash.pairs.forEach(pair => {
        if (pair.key === 'guid') {
            throw new _syntaxError2.default('Cannot pass `guid` from user space', loc);
        }
        if (pair.key === 'nextSibling') {
            hasNextSibling = true;
        }
    });
    let guid = _builders2.default.literal('StringLiteral', cursor);
    let guidPair = _builders2.default.pair('guid', guid);
    hash.pairs.unshift(guidPair);
    if (!hasNextSibling) {
        let nullLiteral = _builders2.default.literal('NullLiteral', null);
        let nextSibling = _builders2.default.pair('nextSibling', nullLiteral);
        hash.pairs.push(nextSibling);
    }
    return hash;
}
function appendDynamicAttributeValuePart(attribute, part) {
    attribute.isDynamic = true;
    attribute.parts.push(part);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlYmFycy1ub2RlLXZpc2l0b3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvQGdsaW1tZXIvc3ludGF4L2xpYi9wYXJzZXIvaGFuZGxlYmFycy1ub2RlLXZpc2l0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxBQUFPLEFBQUMsQUFBTSxBQUFhLEFBQUM7Ozs7QUFDNUIsQUFBTyxBQUFFLEFBQVcsQUFBRSxBQUFTLEFBQUUsQUFBWSxBQUFFLEFBQU0sQUFBVSxBQUFDOztBQUdoRSxBQUFPLEFBQUUsQUFBTSxBQUFrQixBQUFNLEFBQVcsQUFBQzs7QUFDbkQsQUFBTyxBQUFXLEFBQU0sQUFBd0IsQUFBQyxBQUlqRCxBQUFNOzs7Ozs7TUFBdUMsQUFBUSxBQUFNOztpQkFLekQ7YUFBVyxjQUFHLEFBQUMsQUFBQyxBQXFRbEIsQUFBQztBQW5RQyxBQUFNO2FBQ0osQUFBTSxBQUFDOzBCQUFXLEFBQUksS0FBQyxBQUFXLEFBQUUsQUFBRyxBQUFDLEFBQzFDLGFBQUM7QUFFRCxBQUFPO1lBQUMsQUFBOEIsU0FDcEM7WUFBSSxBQUFJLE9BQW9CLEFBQUUsQUFBQyxBQUMvQixBQUFJO2FBQUMsQUFBVyxjQUFHLEFBQUMsQUFBQyxBQUNyQjtZQUFJLEFBQUksT0FBRyxBQUFDLG1CQUFDLEFBQU8sUUFBQyxBQUFJLE1BQUUsQUFBTyxRQUFDLEFBQVcsYUFBRSxBQUFPLFFBQUMsQUFBRyxBQUFDLEFBQUMsQUFDN0Q7WUFBSSxBQUFDO1lBQUUsQUFBQyxJQUFHLEFBQU8sUUFBQyxBQUFJLEtBQUMsQUFBTSxBQUFDLEFBRS9CLEFBQUk7YUFBQyxBQUFZLGFBQUMsQUFBSSxLQUFDLEFBQUksQUFBQyxBQUFDLEFBRTdCLEFBQUUsQUFBQztZQUFDLEFBQUMsTUFBSyxBQUFDLEFBQUMsR0FBQyxBQUFDLEFBQUMsQUFBTTttQkFBQyxBQUFJLEtBQUMsQUFBWSxhQUFDLEFBQUcsQUFBaUIs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QUFBRSxBQUFDO1FBQUMsQ0FBQyxBQUFjLEFBQUMsZ0JBQUMsQUFBQyxBQUNwQjtZQUFJLEFBQVcsY0FBRyxBQUFDLG1CQUFDLEFBQU8sUUFBQyxBQUFhLGVBQUUsQUFBSSxBQUFDLEFBQUMsQUFDakQ7WUFBSSxBQUFXLGNBQUcsQUFBQyxtQkFBQyxBQUFJLEtBQUMsQUFBYSxlQUFFLEFBQVcsQUFBQyxBQUFDLEFBQ3JELEFBQUk7YUFBQyxBQUFLLE1BQUMsQUFBSSxLQUFDLEFBQVcsQUFBQyxBQUFDLEFBQy9CLEFBQUM7QUFFRCxBQUFNO1dBQUMsQUFBSSxBQUFDLEFBQ2QsQUFBQzs7QUFFRCx5Q0FBeUMsQUFBb0IsV0FBRSxBQUEyQixNQUN4RixBQUFTO2NBQUMsQUFBUyxZQUFHLEFBQUksQUFBQyxBQUMzQixBQUFTO2NBQUMsQUFBSyxNQUFDLEFBQUksS0FBQyxBQUFJLEFBQUMsQUFBQyxBQUM3QixBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGIgZnJvbSBcIi4uL2J1aWxkZXJzXCI7XG5pbXBvcnQgeyBhcHBlbmRDaGlsZCwgaXNMaXRlcmFsLCBwcmludExpdGVyYWwgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCAqIGFzIEFTVCBmcm9tICcuLi90eXBlcy9ub2Rlcyc7XG5pbXBvcnQgKiBhcyBIYW5kbGViYXJzQVNUIGZyb20gJy4uL3R5cGVzL2hhbmRsZWJhcnMtYXN0JztcbmltcG9ydCB7IFBhcnNlciwgVGFnLCBBdHRyaWJ1dGUgfSBmcm9tICcuLi9wYXJzZXInO1xuaW1wb3J0IFN5bnRheEVycm9yIGZyb20gJy4uL2Vycm9ycy9zeW50YXgtZXJyb3InO1xuaW1wb3J0IHsgT3B0aW9uIH0gZnJvbSBcIkBnbGltbWVyL3V0aWxcIjtcbmltcG9ydCB7IFJlY2FzdCB9IGZyb20gXCJAZ2xpbW1lci9pbnRlcmZhY2VzXCI7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBIYW5kbGViYXJzTm9kZVZpc2l0b3JzIGV4dGVuZHMgUGFyc2VyIHtcbiAgYWJzdHJhY3QgYXBwZW5kVG9Db21tZW50RGF0YShzOiBzdHJpbmcpOiB2b2lkO1xuICBhYnN0cmFjdCBiZWdpbkF0dHJpYnV0ZVZhbHVlKHF1b3RlZDogYm9vbGVhbik6IHZvaWQ7XG4gIGFic3RyYWN0IGZpbmlzaEF0dHJpYnV0ZVZhbHVlKCk6IHZvaWQ7XG5cbiAgY3Vyc29yQ291bnQgPSAwO1xuXG4gIGN1cnNvcigpIHtcbiAgICByZXR1cm4gYCVjdXJzb3I6JHt0aGlzLmN1cnNvckNvdW50Kyt9JWA7XG4gIH1cblxuICBQcm9ncmFtKHByb2dyYW06IEhhbmRsZWJhcnNBU1QuUHJvZ3JhbSk6IEFTVC5Qcm9ncmFtIHtcbiAgICBsZXQgYm9keTogQVNULlN0YXRlbWVudFtdID0gW107XG4gICAgdGhpcy5jdXJzb3JDb3VudCA9IDA7XG4gICAgbGV0IG5vZGUgPSBiLnByb2dyYW0oYm9keSwgcHJvZ3JhbS5ibG9ja1BhcmFtcywgcHJvZ3JhbS5sb2MpO1xuICAgIGxldCBpLCBsID0gcHJvZ3JhbS5ib2R5Lmxlbmd0aDtcblxuICAgIHRoaXMuZWxlbWVudFN0YWNrLnB1c2gobm9kZSk7XG5cbiAgICBpZiAobCA9PT0gMCkgeyByZXR1cm4gdGhpcy5lbGVtZW50U3RhY2sucG9wKCkgYXMgQVNULlByb2dyYW07IH1cblxuICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgIHRoaXMuYWNjZXB0Tm9kZShwcm9ncmFtLmJvZHlbaV0pO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSB0aGF0IHRoYXQgdGhlIGVsZW1lbnQgc3RhY2sgaXMgYmFsYW5jZWQgcHJvcGVybHkuXG4gICAgbGV0IHBvcHBlZE5vZGUgPSB0aGlzLmVsZW1lbnRTdGFjay5wb3AoKTtcbiAgICBpZiAocG9wcGVkTm9kZSAhPT0gbm9kZSkge1xuICAgICAgbGV0IGVsZW1lbnROb2RlID0gcG9wcGVkTm9kZSBhcyBBU1QuRWxlbWVudE5vZGU7XG5cbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcIlVuY2xvc2VkIGVsZW1lbnQgYFwiICsgZWxlbWVudE5vZGUudGFnICsgXCJgIChvbiBsaW5lIFwiICsgZWxlbWVudE5vZGUubG9jIS5zdGFydC5saW5lICsgXCIpLlwiLCBlbGVtZW50Tm9kZS5sb2MpO1xuICAgIH1cblxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgQmxvY2tTdGF0ZW1lbnQoYmxvY2s6IEhhbmRsZWJhcnNBU1QuQmxvY2tTdGF0ZW1lbnQpIHtcbiAgICBpZiAodGhpcy50b2tlbml6ZXJbJ3N0YXRlJ10gPT09ICdjb21tZW50Jykge1xuICAgICAgdGhpcy5hcHBlbmRUb0NvbW1lbnREYXRhKHRoaXMuc291cmNlRm9yTm9kZShibG9jaykpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRva2VuaXplclsnc3RhdGUnXSAhPT0gJ2NvbW1lbnQnICYmIHRoaXMudG9rZW5pemVyWydzdGF0ZSddICE9PSAnZGF0YScgJiYgdGhpcy50b2tlbml6ZXJbJ3N0YXRlJ10gIT09ICdiZWZvcmVEYXRhJykge1xuICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFwiQSBibG9jayBtYXkgb25seSBiZSB1c2VkIGluc2lkZSBhbiBIVE1MIGVsZW1lbnQgb3IgYW5vdGhlciBibG9jay5cIiwgYmxvY2subG9jKTtcbiAgICB9XG5cbiAgICBsZXQgeyBwYXRoLCBwYXJhbXMsIGhhc2ggfSA9IGFjY2VwdENhbGxOb2Rlcyh0aGlzLCBibG9jayk7XG4gICAgbGV0IHByb2dyYW0gPSB0aGlzLlByb2dyYW0oYmxvY2sucHJvZ3JhbSk7XG4gICAgbGV0IGludmVyc2UgPSBibG9jay5pbnZlcnNlID8gdGhpcy5Qcm9ncmFtKGJsb2NrLmludmVyc2UpIDogbnVsbDtcblxuICAgIGlmKHBhdGgub3JpZ2luYWwgPT09ICdpbi1lbGVtZW50Jykge1xuICAgICAgaGFzaCA9IGFkZEluRWxlbWVudEhhc2godGhpcy5jdXJzb3IoKSwgaGFzaCwgYmxvY2subG9jKTtcbiAgICB9XG5cbiAgICBsZXQgbm9kZSA9IGIuYmxvY2socGF0aCwgcGFyYW1zLCBoYXNoLCBwcm9ncmFtLCBpbnZlcnNlLCBibG9jay5sb2MpO1xuXG4gICAgbGV0IHBhcmVudFByb2dyYW0gPSB0aGlzLmN1cnJlbnRFbGVtZW50KCk7XG4gICAgYXBwZW5kQ2hpbGQocGFyZW50UHJvZ3JhbSwgbm9kZSk7XG4gIH1cblxuICBNdXN0YWNoZVN0YXRlbWVudChyYXdNdXN0YWNoZTogSGFuZGxlYmFyc0FTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIGxldCB7IHRva2VuaXplciB9ID0gdGhpcztcblxuICAgIGlmICh0b2tlbml6ZXJbJ3N0YXRlJ10gPT09ICdjb21tZW50Jykge1xuICAgICAgdGhpcy5hcHBlbmRUb0NvbW1lbnREYXRhKHRoaXMuc291cmNlRm9yTm9kZShyYXdNdXN0YWNoZSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBtdXN0YWNoZTogQVNULk11c3RhY2hlU3RhdGVtZW50O1xuICAgIGxldCB7IGVzY2FwZWQsIGxvYyB9ID0gcmF3TXVzdGFjaGU7XG5cbiAgICBpZiAocmF3TXVzdGFjaGUucGF0aC50eXBlLm1hdGNoKC9MaXRlcmFsJC8pKSB7XG4gICAgICBtdXN0YWNoZSA9IHtcbiAgICAgICAgdHlwZTogJ011c3RhY2hlU3RhdGVtZW50JyxcbiAgICAgICAgcGF0aDogdGhpcy5hY2NlcHROb2RlPEFTVC5MaXRlcmFsPihyYXdNdXN0YWNoZS5wYXRoKSxcbiAgICAgICAgcGFyYW1zOiBbXSxcbiAgICAgICAgaGFzaDogYi5oYXNoKCksXG4gICAgICAgIGVzY2FwZWQsXG4gICAgICAgIGxvY1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHsgcGF0aCwgcGFyYW1zLCBoYXNoIH0gPSBhY2NlcHRDYWxsTm9kZXModGhpcywgcmF3TXVzdGFjaGUgYXMgSGFuZGxlYmFyc0FTVC5NdXN0YWNoZVN0YXRlbWVudCAmIHsgcGF0aDogSGFuZGxlYmFyc0FTVC5QYXRoRXhwcmVzc2lvbiB9KTtcbiAgICAgIG11c3RhY2hlID0gYi5tdXN0YWNoZShwYXRoLCBwYXJhbXMsIGhhc2gsICFlc2NhcGVkLCBsb2MpO1xuICAgIH1cblxuICAgIHN3aXRjaCAodG9rZW5pemVyWydzdGF0ZSddKSB7XG4gICAgICAvLyBUYWcgaGVscGVyc1xuICAgICAgY2FzZSBcInRhZ05hbWVcIjpcbiAgICAgICAgYWRkRWxlbWVudE1vZGlmaWVyKHRoaXMuY3VycmVudFN0YXJ0VGFnLCBtdXN0YWNoZSk7XG4gICAgICAgIHRva2VuaXplclsnc3RhdGUnXSA9IFwiYmVmb3JlQXR0cmlidXRlTmFtZVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJiZWZvcmVBdHRyaWJ1dGVOYW1lXCI6XG4gICAgICAgIGFkZEVsZW1lbnRNb2RpZmllcih0aGlzLmN1cnJlbnRTdGFydFRhZywgbXVzdGFjaGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhdHRyaWJ1dGVOYW1lXCI6XG4gICAgICBjYXNlIFwiYWZ0ZXJBdHRyaWJ1dGVOYW1lXCI6XG4gICAgICAgIHRoaXMuYmVnaW5BdHRyaWJ1dGVWYWx1ZShmYWxzZSk7XG4gICAgICAgIHRoaXMuZmluaXNoQXR0cmlidXRlVmFsdWUoKTtcbiAgICAgICAgYWRkRWxlbWVudE1vZGlmaWVyKHRoaXMuY3VycmVudFN0YXJ0VGFnLCBtdXN0YWNoZSk7XG4gICAgICAgIHRva2VuaXplclsnc3RhdGUnXSA9IFwiYmVmb3JlQXR0cmlidXRlTmFtZVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhZnRlckF0dHJpYnV0ZVZhbHVlUXVvdGVkXCI6XG4gICAgICAgIGFkZEVsZW1lbnRNb2RpZmllcih0aGlzLmN1cnJlbnRTdGFydFRhZywgbXVzdGFjaGUpO1xuICAgICAgICB0b2tlbml6ZXJbJ3N0YXRlJ10gPSBcImJlZm9yZUF0dHJpYnV0ZU5hbWVcIjtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIC8vIEF0dHJpYnV0ZSB2YWx1ZXNcbiAgICAgIGNhc2UgXCJiZWZvcmVBdHRyaWJ1dGVWYWx1ZVwiOlxuICAgICAgICB0aGlzLmJlZ2luQXR0cmlidXRlVmFsdWUoZmFsc2UpO1xuICAgICAgICBhcHBlbmREeW5hbWljQXR0cmlidXRlVmFsdWVQYXJ0KHRoaXMuY3VycmVudEF0dHJpYnV0ZSEsIG11c3RhY2hlKTtcbiAgICAgICAgdG9rZW5pemVyWydzdGF0ZSddID0gJ2F0dHJpYnV0ZVZhbHVlVW5xdW90ZWQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhdHRyaWJ1dGVWYWx1ZURvdWJsZVF1b3RlZFwiOlxuICAgICAgY2FzZSBcImF0dHJpYnV0ZVZhbHVlU2luZ2xlUXVvdGVkXCI6XG4gICAgICBjYXNlIFwiYXR0cmlidXRlVmFsdWVVbnF1b3RlZFwiOlxuICAgICAgICBhcHBlbmREeW5hbWljQXR0cmlidXRlVmFsdWVQYXJ0KHRoaXMuY3VycmVudEF0dHJpYnV0ZSEsIG11c3RhY2hlKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIC8vIFRPRE86IE9ubHkgYXBwZW5kIGNoaWxkIHdoZW4gdGhlIHRva2VuaXplciBzdGF0ZSBtYWtlc1xuICAgICAgLy8gc2Vuc2UgdG8gZG8gc28sIG90aGVyd2lzZSB0aHJvdyBhbiBlcnJvci5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFwcGVuZENoaWxkKHRoaXMuY3VycmVudEVsZW1lbnQoKSwgbXVzdGFjaGUpO1xuICAgIH1cblxuICAgIHJldHVybiBtdXN0YWNoZTtcbiAgfVxuXG4gIENvbnRlbnRTdGF0ZW1lbnQoY29udGVudDogSGFuZGxlYmFyc0FTVC5Db250ZW50U3RhdGVtZW50KSB7XG4gICAgdXBkYXRlVG9rZW5pemVyTG9jYXRpb24odGhpcy50b2tlbml6ZXIsIGNvbnRlbnQpO1xuXG4gICAgdGhpcy50b2tlbml6ZXIudG9rZW5pemVQYXJ0KGNvbnRlbnQudmFsdWUpO1xuICAgIHRoaXMudG9rZW5pemVyLmZsdXNoRGF0YSgpO1xuICB9XG5cbiAgQ29tbWVudFN0YXRlbWVudChyYXdDb21tZW50OiBIYW5kbGViYXJzQVNULkNvbW1lbnRTdGF0ZW1lbnQpOiBPcHRpb248QVNULk11c3RhY2hlQ29tbWVudFN0YXRlbWVudD4ge1xuICAgIGxldCB7IHRva2VuaXplciB9ID0gdGhpcztcblxuICAgIGlmICh0b2tlbml6ZXJbJ3N0YXRlJ10gPT09ICdjb21tZW50Jykge1xuICAgICAgdGhpcy5hcHBlbmRUb0NvbW1lbnREYXRhKHRoaXMuc291cmNlRm9yTm9kZShyYXdDb21tZW50KSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBsZXQgeyB2YWx1ZSwgbG9jIH0gPSByYXdDb21tZW50O1xuICAgIGxldCBjb21tZW50ID0gYi5tdXN0YWNoZUNvbW1lbnQodmFsdWUsIGxvYyk7XG5cbiAgICBzd2l0Y2ggKHRva2VuaXplclsnc3RhdGUnXSkge1xuICAgICAgY2FzZSBcImJlZm9yZUF0dHJpYnV0ZU5hbWVcIjpcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhcnRUYWcuY29tbWVudHMucHVzaChjb21tZW50KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2JlZm9yZURhdGEnOlxuICAgICAgY2FzZSAnZGF0YSc6XG4gICAgICAgIGFwcGVuZENoaWxkKHRoaXMuY3VycmVudEVsZW1lbnQoKSwgY29tbWVudCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYFVzaW5nIGEgSGFuZGxlYmFycyBjb21tZW50IHdoZW4gaW4gdGhlIFxcYCR7dG9rZW5pemVyWydzdGF0ZSddfVxcYCBzdGF0ZSBpcyBub3Qgc3VwcG9ydGVkOiBcIiR7Y29tbWVudC52YWx1ZX1cIiBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9OiR7bG9jLnN0YXJ0LmNvbHVtbn1gLCByYXdDb21tZW50LmxvYyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbW1lbnQ7XG4gIH1cblxuICBQYXJ0aWFsU3RhdGVtZW50KHBhcnRpYWw6IEhhbmRsZWJhcnNBU1QuUGFydGlhbFN0YXRlbWVudCkge1xuICAgIGxldCB7IGxvYyB9ID0gcGFydGlhbDtcblxuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgSGFuZGxlYmFycyBwYXJ0aWFscyBhcmUgbm90IHN1cHBvcnRlZDogXCIke3RoaXMuc291cmNlRm9yTm9kZShwYXJ0aWFsLCBwYXJ0aWFsLm5hbWUpfVwiIGF0IEwke2xvYy5zdGFydC5saW5lfTpDJHtsb2Muc3RhcnQuY29sdW1ufWAsIHBhcnRpYWwubG9jKTtcbiAgfVxuXG4gIFBhcnRpYWxCbG9ja1N0YXRlbWVudChwYXJ0aWFsQmxvY2s6IEhhbmRsZWJhcnNBU1QuUGFydGlhbEJsb2NrU3RhdGVtZW50KSB7XG4gICAgbGV0IHsgbG9jIH0gPSBwYXJ0aWFsQmxvY2s7XG5cbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYEhhbmRsZWJhcnMgcGFydGlhbCBibG9ja3MgYXJlIG5vdCBzdXBwb3J0ZWQ6IFwiJHt0aGlzLnNvdXJjZUZvck5vZGUocGFydGlhbEJsb2NrLCBwYXJ0aWFsQmxvY2submFtZSl9XCIgYXQgTCR7bG9jLnN0YXJ0LmxpbmV9OkMke2xvYy5zdGFydC5jb2x1bW59YCwgcGFydGlhbEJsb2NrLmxvYyk7XG4gIH1cblxuICBEZWNvcmF0b3IoZGVjb3JhdG9yOiBIYW5kbGViYXJzQVNULkRlY29yYXRvcikge1xuICAgIGxldCB7IGxvYyB9ID0gZGVjb3JhdG9yO1xuXG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBIYW5kbGViYXJzIGRlY29yYXRvcnMgYXJlIG5vdCBzdXBwb3J0ZWQ6IFwiJHt0aGlzLnNvdXJjZUZvck5vZGUoZGVjb3JhdG9yLCBkZWNvcmF0b3IucGF0aCl9XCIgYXQgTCR7bG9jLnN0YXJ0LmxpbmV9OkMke2xvYy5zdGFydC5jb2x1bW59YCwgZGVjb3JhdG9yLmxvYyk7XG4gIH1cblxuICBEZWNvcmF0b3JCbG9jayhkZWNvcmF0b3JCbG9jazogSGFuZGxlYmFyc0FTVC5EZWNvcmF0b3JCbG9jaykge1xuICAgIGxldCB7IGxvYyB9ID0gZGVjb3JhdG9yQmxvY2s7XG5cbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYEhhbmRsZWJhcnMgZGVjb3JhdG9yIGJsb2NrcyBhcmUgbm90IHN1cHBvcnRlZDogXCIke3RoaXMuc291cmNlRm9yTm9kZShkZWNvcmF0b3JCbG9jaywgZGVjb3JhdG9yQmxvY2sucGF0aCl9XCIgYXQgTCR7bG9jLnN0YXJ0LmxpbmV9OkMke2xvYy5zdGFydC5jb2x1bW59YCwgZGVjb3JhdG9yQmxvY2subG9jKTtcbiAgfVxuXG4gIFN1YkV4cHJlc3Npb24oc2V4cHI6IEhhbmRsZWJhcnNBU1QuU3ViRXhwcmVzc2lvbik6IEFTVC5TdWJFeHByZXNzaW9uIHtcbiAgICBsZXQgeyBwYXRoLCBwYXJhbXMsIGhhc2ggfSA9IGFjY2VwdENhbGxOb2Rlcyh0aGlzLCBzZXhwcik7XG4gICAgcmV0dXJuIGIuc2V4cHIocGF0aCwgcGFyYW1zLCBoYXNoLCBzZXhwci5sb2MpO1xuICB9XG5cbiAgUGF0aEV4cHJlc3Npb24ocGF0aDogSGFuZGxlYmFyc0FTVC5QYXRoRXhwcmVzc2lvbik6IEFTVC5QYXRoRXhwcmVzc2lvbiB7XG4gICAgbGV0IHsgb3JpZ2luYWwsIGxvYyB9ID0gcGF0aDtcbiAgICBsZXQgcGFydHM6IHN0cmluZ1tdO1xuXG4gICAgaWYgKG9yaWdpbmFsLmluZGV4T2YoJy8nKSAhPT0gLTEpIHtcbiAgICAgIGlmIChvcmlnaW5hbC5zbGljZSgwLCAyKSA9PT0gJy4vJykge1xuICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYFVzaW5nIFwiLi9cIiBpcyBub3Qgc3VwcG9ydGVkIGluIEdsaW1tZXIgYW5kIHVubmVjZXNzYXJ5OiBcIiR7cGF0aC5vcmlnaW5hbH1cIiBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9LmAsIHBhdGgubG9jKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcmlnaW5hbC5zbGljZSgwLCAzKSA9PT0gJy4uLycpIHtcbiAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBDaGFuZ2luZyBjb250ZXh0IHVzaW5nIFwiLi4vXCIgaXMgbm90IHN1cHBvcnRlZCBpbiBHbGltbWVyOiBcIiR7cGF0aC5vcmlnaW5hbH1cIiBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9LmAsIHBhdGgubG9jKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcmlnaW5hbC5pbmRleE9mKCcuJykgIT09IC0xKSB7XG4gICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgTWl4aW5nICcuJyBhbmQgJy8nIGluIHBhdGhzIGlzIG5vdCBzdXBwb3J0ZWQgaW4gR2xpbW1lcjsgdXNlIG9ubHkgJy4nIHRvIHNlcGFyYXRlIHByb3BlcnR5IHBhdGhzOiBcIiR7cGF0aC5vcmlnaW5hbH1cIiBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9LmAsIHBhdGgubG9jKTtcbiAgICAgIH1cbiAgICAgIHBhcnRzID0gWyBwYXRoLnBhcnRzLmpvaW4oJy8nKSBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJ0cyA9IHBhdGgucGFydHM7XG4gICAgfVxuXG4gICAgbGV0IHRoaXNIZWFkID0gZmFsc2U7XG5cbiAgICAvLyBUaGlzIGlzIHRvIGZpeCBhIGJ1ZyBpbiB0aGUgSGFuZGxlYmFycyBBU1Qgd2hlcmUgdGhlIHBhdGggZXhwcmVzc2lvbnMgaW5cbiAgICAvLyBge3t0aGlzLmZvb319YCAoYW5kIHNpbWlsYXJseSBge3tmb28tYmFyIHRoaXMuZm9vIG5hbWVkPXRoaXMuZm9vfX1gIGV0YylcbiAgICAvLyBhcmUgc2ltcGx5IHR1cm5lZCBpbnRvIGB7e2Zvb319YC4gVGhlIGZpeCBpcyB0byBwdXNoIGl0IGJhY2sgb250byB0aGVcbiAgICAvLyBwYXJ0cyBhcnJheSBhbmQgbGV0IHRoZSBydW50aW1lIHNlZSB0aGUgZGlmZmVyZW5jZS4gSG93ZXZlciwgd2UgY2Fubm90XG4gICAgLy8gc2ltcGx5IHVzZSB0aGUgc3RyaW5nIGB0aGlzYCBhcyBpdCBtZWFucyBsaXRlcmFsbHkgdGhlIHByb3BlcnR5IGNhbGxlZFxuICAgIC8vIFwidGhpc1wiIGluIHRoZSBjdXJyZW50IGNvbnRleHQgKGl0IGNhbiBiZSBleHByZXNzZWQgaW4gdGhlIHN5bnRheCBhc1xuICAgIC8vIGB7e1t0aGlzXX19YCwgd2hlcmUgdGhlIHNxdWFyZSBicmFja2V0IGFyZSBnZW5lcmFsbHkgZm9yIHRoaXMga2luZCBvZlxuICAgIC8vIGVzY2FwaW5nIOKAkyBzdWNoIGFzIGB7e2Zvby5bXCJiYXIuYmF6XCJdfX1gIHdvdWxkIG1lYW4gbG9va3VwIGEgcHJvcGVydHlcbiAgICAvLyBuYW1lZCBsaXRlcmFsbHkgXCJiYXIuYmF6XCIgb24gYHRoaXMuZm9vYCkuIEJ5IGNvbnZlbnRpb24sIHdlIHVzZSBgbnVsbGBcbiAgICAvLyBmb3IgdGhpcyBwdXJwb3NlLlxuICAgIGlmIChvcmlnaW5hbC5tYXRjaCgvXnRoaXMoXFwuLispPyQvKSkge1xuICAgICAgdGhpc0hlYWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnUGF0aEV4cHJlc3Npb24nLFxuICAgICAgb3JpZ2luYWw6IHBhdGgub3JpZ2luYWwsXG4gICAgICB0aGlzOiB0aGlzSGVhZCxcbiAgICAgIHBhcnRzLFxuICAgICAgZGF0YTogcGF0aC5kYXRhLFxuICAgICAgbG9jOiBwYXRoLmxvY1xuICAgIH07XG4gIH1cblxuICBIYXNoKGhhc2g6IEhhbmRsZWJhcnNBU1QuSGFzaCk6IEFTVC5IYXNoIHtcbiAgICBsZXQgcGFpcnM6IEFTVC5IYXNoUGFpcltdID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhhc2gucGFpcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBwYWlyID0gaGFzaC5wYWlyc1tpXTtcbiAgICAgIHBhaXJzLnB1c2goYi5wYWlyKHBhaXIua2V5LCB0aGlzLmFjY2VwdE5vZGU8QVNULkV4cHJlc3Npb24+KHBhaXIudmFsdWUpLCBwYWlyLmxvYykpO1xuICAgIH1cblxuICAgIHJldHVybiBiLmhhc2gocGFpcnMsIGhhc2gubG9jKTtcbiAgfVxuXG4gIFN0cmluZ0xpdGVyYWwoc3RyaW5nOiBIYW5kbGViYXJzQVNULlN0cmluZ0xpdGVyYWwpIHtcbiAgICByZXR1cm4gYi5saXRlcmFsKCdTdHJpbmdMaXRlcmFsJywgc3RyaW5nLnZhbHVlLCBzdHJpbmcubG9jKTtcbiAgfVxuXG4gIEJvb2xlYW5MaXRlcmFsKGJvb2xlYW46IEhhbmRsZWJhcnNBU1QuQm9vbGVhbkxpdGVyYWwpIHtcbiAgICByZXR1cm4gYi5saXRlcmFsKCdCb29sZWFuTGl0ZXJhbCcsIGJvb2xlYW4udmFsdWUsIGJvb2xlYW4ubG9jKTtcbiAgfVxuXG4gIE51bWJlckxpdGVyYWwobnVtYmVyOiBIYW5kbGViYXJzQVNULk51bWJlckxpdGVyYWwpIHtcbiAgICByZXR1cm4gYi5saXRlcmFsKCdOdW1iZXJMaXRlcmFsJywgbnVtYmVyLnZhbHVlLCBudW1iZXIubG9jKTtcbiAgfVxuXG4gIFVuZGVmaW5lZExpdGVyYWwodW5kZWY6IEhhbmRsZWJhcnNBU1QuVW5kZWZpbmVkTGl0ZXJhbCkge1xuICAgIHJldHVybiBiLmxpdGVyYWwoJ1VuZGVmaW5lZExpdGVyYWwnLCB1bmRlZmluZWQsIHVuZGVmLmxvYyk7XG4gIH1cblxuICBOdWxsTGl0ZXJhbChudWw6IEhhbmRsZWJhcnNBU1QuTnVsbExpdGVyYWwpIHtcbiAgICByZXR1cm4gYi5saXRlcmFsKCdOdWxsTGl0ZXJhbCcsIG51bGwsIG51bC5sb2MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVJpZ2h0U3RyaXBwZWRPZmZzZXRzKG9yaWdpbmFsOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgaWYgKHZhbHVlID09PSAnJykge1xuICAgIC8vIGlmIGl0IGlzIGVtcHR5LCBqdXN0IHJldHVybiB0aGUgY291bnQgb2YgbmV3bGluZXNcbiAgICAvLyBpbiBvcmlnaW5hbFxuICAgIHJldHVybiB7XG4gICAgICBsaW5lczogb3JpZ2luYWwuc3BsaXQoXCJcXG5cIikubGVuZ3RoIC0gMSxcbiAgICAgIGNvbHVtbnM6IDBcbiAgICB9O1xuICB9XG5cbiAgLy8gb3RoZXJ3aXNlLCByZXR1cm4gdGhlIG51bWJlciBvZiBuZXdsaW5lcyBwcmlvciB0b1xuICAvLyBgdmFsdWVgXG4gIGxldCBkaWZmZXJlbmNlID0gb3JpZ2luYWwuc3BsaXQodmFsdWUpWzBdO1xuICBsZXQgbGluZXMgPSBkaWZmZXJlbmNlLnNwbGl0KC9cXG4vKTtcbiAgbGV0IGxpbmVDb3VudCA9IGxpbmVzLmxlbmd0aCAtIDE7XG5cbiAgcmV0dXJuIHtcbiAgICBsaW5lczogbGluZUNvdW50LFxuICAgIGNvbHVtbnM6IGxpbmVzW2xpbmVDb3VudF0ubGVuZ3RoXG4gIH07XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVRva2VuaXplckxvY2F0aW9uKHRva2VuaXplcjogUGFyc2VyWyd0b2tlbml6ZXInXSwgY29udGVudDogSGFuZGxlYmFyc0FTVC5Db250ZW50U3RhdGVtZW50KSB7XG4gIGxldCBsaW5lID0gY29udGVudC5sb2Muc3RhcnQubGluZTtcbiAgbGV0IGNvbHVtbiA9IGNvbnRlbnQubG9jLnN0YXJ0LmNvbHVtbjtcblxuICBsZXQgb2Zmc2V0cyA9IGNhbGN1bGF0ZVJpZ2h0U3RyaXBwZWRPZmZzZXRzKGNvbnRlbnQub3JpZ2luYWwgYXMgUmVjYXN0PEhhbmRsZWJhcnNBU1QuU3RyaXBGbGFncywgc3RyaW5nPiwgY29udGVudC52YWx1ZSk7XG5cbiAgbGluZSA9IGxpbmUgKyBvZmZzZXRzLmxpbmVzO1xuICBpZiAob2Zmc2V0cy5saW5lcykge1xuICAgIGNvbHVtbiA9IG9mZnNldHMuY29sdW1ucztcbiAgfSBlbHNlIHtcbiAgICBjb2x1bW4gPSBjb2x1bW4gKyBvZmZzZXRzLmNvbHVtbnM7XG4gIH1cblxuICB0b2tlbml6ZXIubGluZSA9IGxpbmU7XG4gIHRva2VuaXplci5jb2x1bW4gPSBjb2x1bW47XG59XG5cbmZ1bmN0aW9uIGFjY2VwdENhbGxOb2Rlcyhjb21waWxlcjogSGFuZGxlYmFyc05vZGVWaXNpdG9ycywgbm9kZTogeyBwYXRoOiBIYW5kbGViYXJzQVNULlBhdGhFeHByZXNzaW9uLCBwYXJhbXM6IEhhbmRsZWJhcnNBU1QuRXhwcmVzc2lvbltdLCBoYXNoOiBIYW5kbGViYXJzQVNULkhhc2ggfSk6IHsgcGF0aDogQVNULlBhdGhFeHByZXNzaW9uLCBwYXJhbXM6IEFTVC5FeHByZXNzaW9uW10sIGhhc2g6IEFTVC5IYXNoIH0ge1xuICBsZXQgcGF0aCA9IGNvbXBpbGVyLlBhdGhFeHByZXNzaW9uKG5vZGUucGF0aCk7XG5cbiAgbGV0IHBhcmFtcyA9IG5vZGUucGFyYW1zID8gbm9kZS5wYXJhbXMubWFwKGUgPT4gY29tcGlsZXIuYWNjZXB0Tm9kZTxBU1QuRXhwcmVzc2lvbj4oZSkpIDogW107XG4gIGxldCBoYXNoID0gbm9kZS5oYXNoID8gY29tcGlsZXIuSGFzaChub2RlLmhhc2gpIDogYi5oYXNoKCk7XG5cbiAgcmV0dXJuIHsgcGF0aCwgcGFyYW1zLCBoYXNoIH07XG59XG5cbmZ1bmN0aW9uIGFkZEVsZW1lbnRNb2RpZmllcihlbGVtZW50OiBUYWc8J1N0YXJ0VGFnJz4sIG11c3RhY2hlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgbGV0IHsgcGF0aCwgcGFyYW1zLCBoYXNoLCBsb2MgfSA9IG11c3RhY2hlO1xuXG4gIGlmIChpc0xpdGVyYWwocGF0aCkpIHtcbiAgICBsZXQgbW9kaWZpZXIgPSBge3ske3ByaW50TGl0ZXJhbChwYXRoKX19fWA7XG4gICAgbGV0IHRhZyA9IGA8JHtlbGVtZW50Lm5hbWV9IC4uLiAke21vZGlmaWVyfSAuLi5gO1xuXG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBJbiAke3RhZ30sICR7bW9kaWZpZXJ9IGlzIG5vdCBhIHZhbGlkIG1vZGlmaWVyOiBcIiR7cGF0aC5vcmlnaW5hbH1cIiBvbiBsaW5lICR7bG9jICYmIGxvYy5zdGFydC5saW5lfS5gLCBtdXN0YWNoZS5sb2MpO1xuICB9XG5cbiAgbGV0IG1vZGlmaWVyID0gYi5lbGVtZW50TW9kaWZpZXIocGF0aCwgcGFyYW1zLCBoYXNoLCBsb2MpO1xuICBlbGVtZW50Lm1vZGlmaWVycy5wdXNoKG1vZGlmaWVyKTtcbn1cblxuZnVuY3Rpb24gYWRkSW5FbGVtZW50SGFzaChjdXJzb3I6IHN0cmluZywgaGFzaDogQVNULkhhc2gsIGxvYzogQVNULlNvdXJjZUxvY2F0aW9uKSB7XG4gIGxldCBoYXNOZXh0U2libGluZyA9IGZhbHNlO1xuICBoYXNoLnBhaXJzLmZvckVhY2goKHBhaXIpID0+IHtcbiAgICBpZiAocGFpci5rZXkgPT09ICdndWlkJykge1xuICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdDYW5ub3QgcGFzcyBgZ3VpZGAgZnJvbSB1c2VyIHNwYWNlJywgbG9jKTtcbiAgICB9XG5cbiAgICBpZiAocGFpci5rZXkgPT09ICduZXh0U2libGluZycpIHtcbiAgICAgIGhhc05leHRTaWJsaW5nID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIGxldCBndWlkID0gYi5saXRlcmFsKCdTdHJpbmdMaXRlcmFsJywgY3Vyc29yKTtcbiAgbGV0IGd1aWRQYWlyID0gYi5wYWlyKCdndWlkJywgZ3VpZCk7XG4gIGhhc2gucGFpcnMudW5zaGlmdChndWlkUGFpcik7XG5cbiAgaWYgKCFoYXNOZXh0U2libGluZykge1xuICAgIGxldCBudWxsTGl0ZXJhbCA9IGIubGl0ZXJhbCgnTnVsbExpdGVyYWwnLCBudWxsKTtcbiAgICBsZXQgbmV4dFNpYmxpbmcgPSBiLnBhaXIoJ25leHRTaWJsaW5nJywgbnVsbExpdGVyYWwpO1xuICAgIGhhc2gucGFpcnMucHVzaChuZXh0U2libGluZyk7XG4gIH1cblxuICByZXR1cm4gaGFzaDtcbn1cblxuZnVuY3Rpb24gYXBwZW5kRHluYW1pY0F0dHJpYnV0ZVZhbHVlUGFydChhdHRyaWJ1dGU6IEF0dHJpYnV0ZSwgcGFydDogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gIGF0dHJpYnV0ZS5pc0R5bmFtaWMgPSB0cnVlO1xuICBhdHRyaWJ1dGUucGFydHMucHVzaChwYXJ0KTtcbn1cbiJdfQ==
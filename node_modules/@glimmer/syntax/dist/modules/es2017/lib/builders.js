import * as AST from './types/nodes';
function buildMustache(path, params, hash, raw, loc) {
    if (!AST.isLiteral(path)) {
        path = buildPath(path);
    }
    return {
        type: "MustacheStatement",
        path,
        params: params || [],
        hash: hash || buildHash([]),
        escaped: !raw,
        loc: buildLoc(loc || null)
    };
}
function buildBlock(path, params, hash, program, inverse, loc) {
    return {
        type: "BlockStatement",
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        program: program || null,
        inverse: inverse || null,
        loc: buildLoc(loc || null)
    };
}
function buildElementModifier(path, params, hash, loc) {
    return {
        type: "ElementModifierStatement",
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPartial(name, params, hash, indent, loc) {
    return {
        type: "PartialStatement",
        name: name,
        params: params || [],
        hash: hash || buildHash([]),
        indent: indent || '',
        strip: { open: false, close: false },
        loc: buildLoc(loc || null)
    };
}
function buildComment(value, loc) {
    return {
        type: "CommentStatement",
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildMustacheComment(value, loc) {
    return {
        type: "MustacheCommentStatement",
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildConcat(parts, loc) {
    return {
        type: "ConcatStatement",
        parts: parts || [],
        loc: buildLoc(loc || null)
    };
}
function buildElement(tag, attributes, modifiers, children, comments, loc) {
    // this is used for backwards compat prior to `comments` being added to the AST
    if (!Array.isArray(comments)) {
        loc = comments;
        comments = [];
    }
    return {
        type: "ElementNode",
        tag: tag || "",
        attributes: attributes || [],
        blockParams: [],
        modifiers: modifiers || [],
        comments: comments || [],
        children: children || [],
        loc: buildLoc(loc || null)
    };
}
function buildAttr(name, value, loc) {
    return {
        type: "AttrNode",
        name: name,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildText(chars, loc) {
    return {
        type: "TextNode",
        chars: chars || "",
        loc: buildLoc(loc || null)
    };
}
// Expressions
function buildSexpr(path, params, hash, loc) {
    return {
        type: "SubExpression",
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPath(original, loc) {
    if (typeof original !== 'string') return original;
    let parts = original.split('.');
    let thisHead = false;
    if (parts[0] === 'this') {
        thisHead = true;
        parts = parts.slice(1);
    }
    return {
        type: "PathExpression",
        original,
        this: thisHead,
        parts,
        data: false,
        loc: buildLoc(loc || null)
    };
}
function buildLiteral(type, value, loc) {
    return {
        type,
        value,
        original: value,
        loc: buildLoc(loc || null)
    };
}
// Miscellaneous
function buildHash(pairs, loc) {
    return {
        type: "Hash",
        pairs: pairs || [],
        loc: buildLoc(loc || null)
    };
}
function buildPair(key, value, loc) {
    return {
        type: "HashPair",
        key: key,
        value,
        loc: buildLoc(loc || null)
    };
}
function buildProgram(body, blockParams, loc) {
    return {
        type: "Program",
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildSource(source) {
    return source || null;
}
function buildPosition(line, column) {
    return {
        line,
        column
    };
}
export const SYNTHETIC = { source: '(synthetic)', start: { line: 1, column: 0 }, end: { line: 1, column: 0 } };
function buildLoc(...args) {
    if (args.length === 1) {
        let loc = args[0];
        if (loc && typeof loc === 'object') {
            return {
                source: buildSource(loc.source),
                start: buildPosition(loc.start.line, loc.start.column),
                end: buildPosition(loc.end.line, loc.end.column)
            };
        } else {
            return SYNTHETIC;
        }
    } else {
        let [startLine, startColumn, endLine, endColumn, source] = args;
        return {
            source: buildSource(source),
            start: buildPosition(startLine, startColumn),
            end: buildPosition(endLine, endColumn)
        };
    }
}
export default {
    mustache: buildMustache,
    block: buildBlock,
    partial: buildPartial,
    comment: buildComment,
    mustacheComment: buildMustacheComment,
    element: buildElement,
    elementModifier: buildElementModifier,
    attr: buildAttr,
    text: buildText,
    sexpr: buildSexpr,
    path: buildPath,
    concat: buildConcat,
    hash: buildHash,
    pair: buildPair,
    literal: buildLiteral,
    program: buildProgram,
    loc: buildLoc,
    pos: buildPosition,
    string: literal('StringLiteral'),
    boolean: literal('BooleanLiteral'),
    number: literal('NumberLiteral'),
    undefined() {
        return buildLiteral('UndefinedLiteral', undefined);
    },
    null() {
        return buildLiteral('NullLiteral', null);
    }
};
function literal(type) {
    return function (value) {
        return buildLiteral(type, value);
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wYWNrYWdlcy9AZ2xpbW1lci9zeW50YXgvbGliL2J1aWxkZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxBQUFHLFNBQU0sQUFBZSxBQUFDO0FBT3JDLHVCQUF1QixBQUErQixNQUFFLEFBQXlCLFFBQUUsQUFBZSxNQUFFLEFBQWEsS0FBRSxBQUF3QjtBQUN6SSxBQUFFLEFBQUMsUUFBQyxDQUFDLEFBQUcsSUFBQyxBQUFTLFVBQUMsQUFBSSxBQUFDLEFBQUMsT0FBQyxBQUFDO0FBQ3pCLEFBQUksZUFBRyxBQUFTLFVBQUMsQUFBSSxBQUFDLEFBQUMsQUFDekI7QUFBQztBQUVELEFBQU07QUFDSixBQUFJLGNBQUUsQUFBbUI7QUFDekIsQUFBSTtBQUNKLEFBQU0sZ0JBQUUsQUFBTSxVQUFJLEFBQUU7QUFDcEIsQUFBSSxjQUFFLEFBQUksUUFBSSxBQUFTLFVBQUMsQUFBRSxBQUFDO0FBQzNCLEFBQU8saUJBQUUsQ0FBQyxBQUFHO0FBQ2IsQUFBRyxhQUFFLEFBQVEsU0FBQyxBQUFHLE9BQUksQUFBSSxBQUFDLEFBQzNCLEFBQUMsQUFDSjtBQVJTO0FBUVI7QUFFRCxvQkFBb0IsQUFBaUIsTUFBRSxBQUFnQyxRQUFFLEFBQXNCLE1BQUUsQUFBb0IsU0FBRSxBQUE2QixTQUFFLEFBQXdCO0FBQzVLLEFBQU07QUFDSixBQUFJLGNBQUUsQUFBZ0I7QUFDdEIsQUFBSSxjQUFFLEFBQVMsVUFBQyxBQUFJLEFBQUM7QUFDckIsQUFBTSxnQkFBRSxBQUFNLFVBQUksQUFBRTtBQUNwQixBQUFJLGNBQUUsQUFBSSxRQUFJLEFBQVMsVUFBQyxBQUFFLEFBQUM7QUFDM0IsQUFBTyxpQkFBRSxBQUFPLFdBQUksQUFBSTtBQUN4QixBQUFPLGlCQUFFLEFBQU8sV0FBSSxBQUFJO0FBQ3hCLEFBQUcsYUFBRSxBQUFRLFNBQUMsQUFBRyxPQUFJLEFBQUks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Li90eXBlcy9ub2Rlcyc7XG5pbXBvcnQgeyBPcHRpb24gfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcblxuLy8gU3RhdGVtZW50c1xuXG5leHBvcnQgdHlwZSBCdWlsZGVyUGF0aCA9IHN0cmluZyB8IEFTVC5QYXRoRXhwcmVzc2lvbjtcblxuZnVuY3Rpb24gYnVpbGRNdXN0YWNoZShwYXRoOiBCdWlsZGVyUGF0aCB8IEFTVC5MaXRlcmFsLCBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLCBoYXNoPzogQVNULkhhc2gsIHJhdz86IGJvb2xlYW4sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCB7XG4gIGlmICghQVNULmlzTGl0ZXJhbChwYXRoKSkge1xuICAgIHBhdGggPSBidWlsZFBhdGgocGF0aCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiTXVzdGFjaGVTdGF0ZW1lbnRcIixcbiAgICBwYXRoLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBlc2NhcGVkOiAhcmF3LFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQmxvY2socGF0aDogQnVpbGRlclBhdGgsIHBhcmFtczogT3B0aW9uPEFTVC5FeHByZXNzaW9uW10+LCBoYXNoOiBPcHRpb248QVNULkhhc2g+LCBwcm9ncmFtOiBBU1QuUHJvZ3JhbSwgaW52ZXJzZT86IE9wdGlvbjxBU1QuUHJvZ3JhbT4sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5CbG9ja1N0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJCbG9ja1N0YXRlbWVudFwiLFxuICAgIHBhdGg6IGJ1aWxkUGF0aChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgcHJvZ3JhbTogcHJvZ3JhbSB8fCBudWxsLFxuICAgIGludmVyc2U6IGludmVyc2UgfHwgbnVsbCxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEVsZW1lbnRNb2RpZmllcihwYXRoOiBCdWlsZGVyUGF0aCwgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSwgaGFzaD86IEFTVC5IYXNoLCBsb2M/OiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPik6IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50XCIsXG4gICAgcGF0aDogYnVpbGRQYXRoKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhcnRpYWwobmFtZTogQVNULlBhdGhFeHByZXNzaW9uLCBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLCBoYXNoPzogQVNULkhhc2gsIGluZGVudD86IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULlBhcnRpYWxTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiUGFydGlhbFN0YXRlbWVudFwiLFxuICAgIG5hbWU6IG5hbWUsXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGluZGVudDogaW5kZW50IHx8ICcnLFxuICAgIHN0cmlwOiB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbW1lbnQodmFsdWU6IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiQ29tbWVudFN0YXRlbWVudFwiLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZE11c3RhY2hlQ29tbWVudCh2YWx1ZTogc3RyaW5nLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcIk11c3RhY2hlQ29tbWVudFN0YXRlbWVudFwiLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbmNhdChwYXJ0czogKEFTVC5UZXh0Tm9kZSB8IEFTVC5NdXN0YWNoZVN0YXRlbWVudClbXSwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkNvbmNhdFN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJDb25jYXRTdGF0ZW1lbnRcIixcbiAgICBwYXJ0czogcGFydHMgfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbClcbiAgfTtcbn1cblxuLy8gTm9kZXNcblxuZnVuY3Rpb24gYnVpbGRFbGVtZW50KHRhZzogc3RyaW5nLCBhdHRyaWJ1dGVzPzogQVNULkF0dHJOb2RlW10sIG1vZGlmaWVycz86IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnRbXSwgY2hpbGRyZW4/OiBBU1QuU3RhdGVtZW50W10sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5FbGVtZW50Tm9kZTtcbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudCh0YWc6IHN0cmluZywgYXR0cmlidXRlcz86IEFTVC5BdHRyTm9kZVtdLCBtb2RpZmllcnM/OiBBU1QuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50W10sIGNoaWxkcmVuPzogQVNULlN0YXRlbWVudFtdLCBjb21tZW50cz86IEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnRbXSwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkVsZW1lbnROb2RlO1xuXG5mdW5jdGlvbiBidWlsZEVsZW1lbnQodGFnOiBzdHJpbmcsIGF0dHJpYnV0ZXM/OiBBU1QuQXR0ck5vZGVbXSwgbW9kaWZpZXJzPzogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudFtdLCBjaGlsZHJlbj86IEFTVC5TdGF0ZW1lbnRbXSwgY29tbWVudHM/OiBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50W10gfCBBU1QuU291cmNlTG9jYXRpb24sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5FbGVtZW50Tm9kZSB7XG4gIC8vIHRoaXMgaXMgdXNlZCBmb3IgYmFja3dhcmRzIGNvbXBhdCBwcmlvciB0byBgY29tbWVudHNgIGJlaW5nIGFkZGVkIHRvIHRoZSBBU1RcbiAgaWYgKCFBcnJheS5pc0FycmF5KGNvbW1lbnRzKSkge1xuICAgIGxvYyA9IGNvbW1lbnRzO1xuICAgIGNvbW1lbnRzID0gW107XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiRWxlbWVudE5vZGVcIixcbiAgICB0YWc6IHRhZyB8fCBcIlwiLFxuICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IFtdLFxuICAgIG1vZGlmaWVyczogbW9kaWZpZXJzIHx8IFtdLFxuICAgIGNvbW1lbnRzOiBjb21tZW50cyB8fCBbXSxcbiAgICBjaGlsZHJlbjogY2hpbGRyZW4gfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbClcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRBdHRyKG5hbWU6IHN0cmluZywgdmFsdWU6IEFTVC5BdHRyTm9kZVsndmFsdWUnXSwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkF0dHJOb2RlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcIkF0dHJOb2RlXCIsXG4gICAgbmFtZTogbmFtZSxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbClcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRUZXh0KGNoYXJzPzogc3RyaW5nLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuVGV4dE5vZGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiVGV4dE5vZGVcIixcbiAgICBjaGFyczogY2hhcnMgfHwgXCJcIixcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG4vLyBFeHByZXNzaW9uc1xuXG5mdW5jdGlvbiBidWlsZFNleHByKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbiwgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSwgaGFzaD86IEFTVC5IYXNoLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuU3ViRXhwcmVzc2lvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJTdWJFeHByZXNzaW9uXCIsXG4gICAgcGF0aDogYnVpbGRQYXRoKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhdGgob3JpZ2luYWw6IEJ1aWxkZXJQYXRoLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuUGF0aEV4cHJlc3Npb24ge1xuICBpZiAodHlwZW9mIG9yaWdpbmFsICE9PSAnc3RyaW5nJykgcmV0dXJuIG9yaWdpbmFsO1xuXG4gIGxldCBwYXJ0cyA9IG9yaWdpbmFsLnNwbGl0KCcuJyk7XG4gIGxldCB0aGlzSGVhZCA9IGZhbHNlO1xuXG4gIGlmIChwYXJ0c1swXSA9PT0gJ3RoaXMnKSB7XG4gICAgdGhpc0hlYWQgPSB0cnVlO1xuICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiUGF0aEV4cHJlc3Npb25cIixcbiAgICBvcmlnaW5hbCxcbiAgICB0aGlzOiB0aGlzSGVhZCxcbiAgICBwYXJ0cyxcbiAgICBkYXRhOiBmYWxzZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZExpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPih0eXBlOiBUWyd0eXBlJ10sIHZhbHVlOiBUWyd2YWx1ZSddLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuTGl0ZXJhbCB7XG4gIHJldHVybiB7XG4gICAgdHlwZSxcbiAgICB2YWx1ZSxcbiAgICBvcmlnaW5hbDogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbClcbiAgfSBhcyBBU1QuTGl0ZXJhbDtcbn1cblxuLy8gTWlzY2VsbGFuZW91c1xuXG5mdW5jdGlvbiBidWlsZEhhc2gocGFpcnM/OiBBU1QuSGFzaFBhaXJbXSwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2gge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFwiSGFzaFwiLFxuICAgIHBhaXJzOiBwYWlycyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhaXIoa2V5OiBzdHJpbmcsIHZhbHVlOiBBU1QuRXhwcmVzc2lvbiwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2hQYWlyIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcIkhhc2hQYWlyXCIsXG4gICAga2V5OiBrZXksXG4gICAgdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbClcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQcm9ncmFtKGJvZHk/OiBBU1QuU3RhdGVtZW50W10sIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5Qcm9ncmFtIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBcIlByb2dyYW1cIixcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKVxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFNvdXJjZShzb3VyY2U/OiBzdHJpbmcpIHtcbiAgcmV0dXJuIHNvdXJjZSB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBidWlsZFBvc2l0aW9uKGxpbmU6IG51bWJlciwgY29sdW1uOiBudW1iZXIpIHtcbiAgcmV0dXJuIHtcbiAgICBsaW5lLFxuICAgIGNvbHVtblxuICB9O1xufVxuXG5leHBvcnQgY29uc3QgU1lOVEhFVElDOiBBU1QuU291cmNlTG9jYXRpb24gPSB7IHNvdXJjZTogJyhzeW50aGV0aWMpJywgc3RhcnQ6IHsgbGluZTogMSwgY29sdW1uOiAwIH0sIGVuZDogeyBsaW5lOiAxLCBjb2x1bW46IDAgfSB9O1xuXG5mdW5jdGlvbiBidWlsZExvYyhsb2M6T3B0aW9uPEFTVC5Tb3VyY2VMb2NhdGlvbj4pOiBBU1QuU291cmNlTG9jYXRpb247XG5mdW5jdGlvbiBidWlsZExvYyhzdGFydExpbmU6IG51bWJlciwgc3RhcnRDb2x1bW46IG51bWJlciwgZW5kTGluZT86IG51bWJlciwgZW5kQ29sdW1uPzogbnVtYmVyLCBzb3VyY2U/OiBzdHJpbmcpOiBBU1QuU291cmNlTG9jYXRpb247XG5cbmZ1bmN0aW9uIGJ1aWxkTG9jKC4uLmFyZ3M6IGFueVtdKTogQVNULlNvdXJjZUxvY2F0aW9uIHtcbiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgbGV0IGxvYyA9IGFyZ3NbMF07XG5cbiAgICBpZiAobG9jICYmIHR5cGVvZiBsb2MgPT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzb3VyY2U6IGJ1aWxkU291cmNlKGxvYy5zb3VyY2UpLFxuICAgICAgICBzdGFydDogYnVpbGRQb3NpdGlvbihsb2Muc3RhcnQubGluZSwgbG9jLnN0YXJ0LmNvbHVtbiksXG4gICAgICAgIGVuZDogYnVpbGRQb3NpdGlvbihsb2MuZW5kLmxpbmUsIGxvYy5lbmQuY29sdW1uKVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFNZTlRIRVRJQztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IFsgc3RhcnRMaW5lLCBzdGFydENvbHVtbiwgZW5kTGluZSwgZW5kQ29sdW1uLCBzb3VyY2UgXSA9IGFyZ3M7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogYnVpbGRTb3VyY2Uoc291cmNlKSxcbiAgICAgIHN0YXJ0OiBidWlsZFBvc2l0aW9uKHN0YXJ0TGluZSwgc3RhcnRDb2x1bW4pLFxuICAgICAgZW5kOiBidWlsZFBvc2l0aW9uKGVuZExpbmUsIGVuZENvbHVtbilcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgbXVzdGFjaGU6IGJ1aWxkTXVzdGFjaGUsXG4gIGJsb2NrOiBidWlsZEJsb2NrLFxuICBwYXJ0aWFsOiBidWlsZFBhcnRpYWwsXG4gIGNvbW1lbnQ6IGJ1aWxkQ29tbWVudCxcbiAgbXVzdGFjaGVDb21tZW50OiBidWlsZE11c3RhY2hlQ29tbWVudCxcbiAgZWxlbWVudDogYnVpbGRFbGVtZW50LFxuICBlbGVtZW50TW9kaWZpZXI6IGJ1aWxkRWxlbWVudE1vZGlmaWVyLFxuICBhdHRyOiBidWlsZEF0dHIsXG4gIHRleHQ6IGJ1aWxkVGV4dCxcbiAgc2V4cHI6IGJ1aWxkU2V4cHIsXG4gIHBhdGg6IGJ1aWxkUGF0aCxcbiAgY29uY2F0OiBidWlsZENvbmNhdCxcbiAgaGFzaDogYnVpbGRIYXNoLFxuICBwYWlyOiBidWlsZFBhaXIsXG4gIGxpdGVyYWw6IGJ1aWxkTGl0ZXJhbCxcbiAgcHJvZ3JhbTogYnVpbGRQcm9ncmFtLFxuICBsb2M6IGJ1aWxkTG9jLFxuICBwb3M6IGJ1aWxkUG9zaXRpb24sXG5cbiAgc3RyaW5nOiBsaXRlcmFsKCdTdHJpbmdMaXRlcmFsJyksXG4gIGJvb2xlYW46IGxpdGVyYWwoJ0Jvb2xlYW5MaXRlcmFsJyksXG4gIG51bWJlcjogbGl0ZXJhbCgnTnVtYmVyTGl0ZXJhbCcpLFxuICB1bmRlZmluZWQoKSB7IHJldHVybiBidWlsZExpdGVyYWwoJ1VuZGVmaW5lZExpdGVyYWwnLCB1bmRlZmluZWQpOyB9LFxuICBudWxsKCkgeyByZXR1cm4gYnVpbGRMaXRlcmFsKCdOdWxsTGl0ZXJhbCcsIG51bGwpOyB9XG59O1xuXG5mdW5jdGlvbiBsaXRlcmFsPFQgZXh0ZW5kcyBBU1QuTGl0ZXJhbD4odHlwZTogVFsndHlwZSddKSB7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZTogVFsndmFsdWUnXSkge1xuICAgIHJldHVybiBidWlsZExpdGVyYWwodHlwZSwgdmFsdWUpO1xuICB9O1xufVxuIl19